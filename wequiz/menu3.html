<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- 공통 -->
    <link rel="stylesheet" href="/css/common/reset.css" />
    <link rel="stylesheet" href="/css/common/common.css" />
    <link rel="stylesheet" href="/css/common/module.css" />
    <link rel="stylesheet" href="/css/main.css" />
    <script
      src="https://kit.fontawesome.com/e94ff56eb6.js"
      crossorigin="anonymous"
    ></script>
    <script src="/js/main.js"></script>
    <script src="/js/common/includeHTML.js"></script>
    <!-- 개별 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <title>Menu3</title>
  </head>
  <body>
    <header include-html="header.html" class="headerWrap"></header>
    <section class="bannerWrap"><div>banner</div></section>
    <!-- https://blog.naver.com/comalone/222825716510 -->
    <section class="container text-center">
      <div class="row">
        <div class="col-lg-12">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">No.</th>
                <th scope="col">Title</th>
                <th scope="col">Contents</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td></td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
    <section>
      <div id="map" style="width: 80%; height: 80vh; margin: 0 auto"></div>
    </section>
    <script
      type="text/javascript"
      src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=4f66150b182f5d72949377937580dc83&libraries=clusterer"
    ></script>
    <script>
      const url =
        "https://api.odcloud.kr/api/15077586/v1/centers?page=1&perPage=10&serviceKey=tFwL%2FWQhmOt0VtMKqrGETyKsPGhkkiVBb8%2Fx%2BstTyQ%2F9SRVb4s6wD1HlMbsUOIhbm7bedx5dStmFPFAeZ2FAqg%3D%3D";

      // 인포윈도우를 표시하는 클로저를 만드는 함수입니다
      function makeOverListener(map, marker, infowindow) {
        return function () {
          infowindow.open(map, marker);
        };
      }

      // 인포윈도우를 닫는 클로저를 만드는 함수입니다
      function makeOutListener(infowindow) {
        return function () {
          infowindow.close();
        };
      }

      var mapContainer = document.getElementById("map"), // 지도를 표시할 div
        mapOption = {
          center: new kakao.maps.LatLng(37.60504, 127.05591), // 지도의 중심좌표
          level: 3, // 지도의 확대 레벨
        };

      var map = new kakao.maps.Map(mapContainer, mapOption);

      var clusterer = new kakao.maps.MarkerClusterer({
        map: map, // 마커들을 클러스터로 관리하고 표시할 지도 객체
        averageCenter: true, // 클러스터에 포함된 마커들의 평균 위치를 클러스터 마커 위치로 설정
        minLevel: 5, // 클러스터 할 최소 지도 레벨
      });

      fetch(url)
        .then((res) => res.json())
        .then((myJson) => {
          var markers = [];
          const stores = myJson.data;
          console.log(JSON.stringify(myJson, null, 1));

          console.log(stores);
          for (var i = 0; i < stores.length; i++) {
            var marker = new kakao.maps.Marker({
              position: new kakao.maps.LatLng(
                stores[i]["lat"],
                stores[i]["lng"]
              ),
              map: map,
            });

            var infowindow = new kakao.maps.InfoWindow({
              content: stores[i]["centerName"],
            });

            markers.push(marker);

            kakao.maps.event.addListener(
              marker,
              "mouseover",
              makeOverListener(map, marker, infowindow)
            );
            kakao.maps.event.addListener(
              marker,
              "mouseout",
              makeOutListener(infowindow)
            );
          }

          clusterer.addMarkers(markers);
        });
    </script>

    <script>
      includeHTML();
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
