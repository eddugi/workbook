<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- 공통 -->
    <link rel="stylesheet" href="/css/common/reset.css" />
    <link rel="stylesheet" href="/css/common/common.css" />
    <link rel="stylesheet" href="/css/common/module.css" />
    <link rel="stylesheet" href="/css/main.css" />
    <script
      src="https://kit.fontawesome.com/e94ff56eb6.js"
      crossorigin="anonymous"
    ></script>
    <script src="/js/main.js"></script>
    <script src="/js/common/includeHTML.js"></script>
    <!-- 개별 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <title>Menu3</title>
  </head>

  <style>
    .quiz-list {
      width: 100%;
      height: 120px;
      background: #eeeeee;
      border-radius: 2px;
    }
    quiz {
      display: block;
      padding: 0.5rem;
      width: 100%;
      height: 100%;
      text-align: center;
    }
    quiz p {
      display: block;
      margin: 0.5rem 0;
    }
    answer,
    reset {
      display: inline-block;
      padding: 0.2rem 0.3rem;
      border-radius: 2px;
      border: orange 1px solid;
      cursor: pointer;
    }
  </style>
  <body>
    <header include-html="header.html" class="headerWrap"></header>

    <main>
      <section class="bannerWrap"><div>banner</div></section>
      <!-- https://blog.naver.com/comalone/222825716510 -->

      <div class="quiz-list">
        <quiz>
          <ask>첫 번째 문제입니다</ask>
          <answer point="10">정답</answer>
          <answer>오답</answer>
        </quiz>
        <quiz>
          <ask>두 번째 문제입니다</ask>
          <answer>오답</answer>
          <answer point="20">정답</answer>
          <answer>오답</answer>
        </quiz>
        <quiz>
          <ask>세 번째 문제입니다</ask>
          <answer>오답</answer>
          <answer>오답</answer>
          <answer point="30">정답</answer>
        </quiz>
        <quiz>
          획득한 점수는
          <point></point> / <total></total>
          입니다.
          <reset>다시하기</reset>
        </quiz>
      </div>
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", (event) => {
        document.querySelectorAll(".quiz-list").forEach((quiz_container) => {
          // 각 변수의 초기값을 컨테이너의 속성에 추가한다
          quiz_container.setAttribute("quiz-num", 1);
          quiz_container.setAttribute("quiz-tot", 1);
          quiz_container.setAttribute("point-tot", 0);
          quiz_container.setAttribute("point-get", 0);

          // 컨테이너 안에 있는 퀴즈 페이지 갯수 세기
          let quiz_count = 1;
          quiz_container.querySelectorAll("quiz").forEach((quiz_page) => {
            // 첫 페이지가 아니면 숨김
            if (quiz_count > 1) quiz_page.style.display = "none";
            // 페이지마다 번호 속성 주기
            quiz_page.setAttribute("page", quiz_count);
            quiz_count++;
          });
          quiz_container.setAttribute("quiz-tot", quiz_count - 1);

          // 총 점수 세기
          let point_count = 0;
          quiz_container.querySelectorAll("answer").forEach((answer_item) => {
            if (answer_item.hasAttribute("point")) {
              point_count += Number(answer_item.getAttribute("point"));
            }
          });
          quiz_container.setAttribute("point-tot", point_count);

          // 총점 태그에 값 넣기
          quiz_container.querySelectorAll("total").forEach((tot_str) => {
            tot_str.innerHTML = point_count;
          });

          // 답안에 온클릭 이벤트 넣기
          quiz_container.querySelectorAll("answer").forEach((answer_item) => {
            answer_item.onclick = (event) => {
              let quiz_page = event.target.closest("quiz");
              let quiz_container = quiz_page.parentNode;
              let next = Number(quiz_page.getAttribute("page")) + 1;
              let get_point = Number(quiz_container.getAttribute("point-get"));

              // 클릭한 답안에 포인트가 있는 경우 점수에 합산
              if (event.target.hasAttribute("point")) {
                get_point += Number(event.target.getAttribute("point"));
                quiz_container.setAttribute("point-get", get_point);
              }

              // 포인트 표시 태그 업데이트
              quiz_container.querySelectorAll("point").forEach((get_str) => {
                get_str.innerHTML = get_point;
              });

              // 다음 페이지로 이동
              quiz_page.style.display = "none";
              quiz_container.querySelector(
                `quiz[page="${next}"]`
              ).style.display = "block";
              quiz_container.setAttribute("quiz-num", next);
            };
          });

          // 리셋 태그에 온클릭 이벤트 넣기
          quiz_container.querySelectorAll("reset").forEach((reset_btn) => {
            reset_btn.onclick = (event) => {
              let quiz_page = event.target.closest("quiz");
              let quiz_container = quiz_page.parentNode;

              // 퀴즈 컨테이너의 변수 초기화
              quiz_container.setAttribute("quiz-num", 1);
              quiz_container.setAttribute("point-get", 0);

              // 첫 페이지로 넘어가기
              quiz_page.style.display = "none";
              quiz_container.querySelector(`quiz[page="1"]`).style.display =
                "block";
            };
          });
        });
      });
    </script>

    <script>
      includeHTML();
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
